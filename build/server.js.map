{"version":3,"sources":["../src/server.js"],"names":["dbCon","connection","getConnection","stringify","require","express","cors","bodyParser","app","use","static","corsOptions","origin","optionsSuccessStatus","jsonParser","json","get","req","resp","response","sql","query","err","result","outputs","end","res","researchDetails","queryString","params","id","post","output","body","title","publication_year","additional_info","text","type","save","send","listen","console","log"],"mappings":";;AACA;;AACA;;AACA;AAHA;AAIA,MAAMA,QAAQ,0BAAd;AACA,MAAMC,aAAaD,MAAME,aAAN,EAAnB;AACA;AACA,MAAMC,YAAYC,QAAQ,qBAAR,CAAlB;AACA,MAAMC,UAAUD,QAAQ,SAAR,CAAhB,C,CAAoC;AACpC,MAAME,OAAOF,QAAQ,MAAR,CAAb,C,CAA8B;AAC9B,MAAMG,aAAaH,QAAQ,aAAR,CAAnB;;AAGA,MAAMI,MAAMH,SAAZ;AACA;AACAG,IAAIC,GAAJ,CAAQJ,QAAQK,MAAR,CAAe,QAAf,CAAR,E,CAAmC;AACnCF,IAAIC,GAAJ,CAAQH,MAAR,E,CAAiB;;AAEjB,MAAMK,cAAc;AAChBC,YAAQ,uBADQ;AAEhBC,0BAAsB,GAFN,CAEU;AAFV,CAApB;AAIA,MAAMC,aAAaP,WAAWQ,IAAX,EAAnB;AACA;AACAP,IAAIQ,GAAJ,CAAQ,yBAAR,EAAmCV,KAAKK,WAAL,CAAnC,EACA,CAACM,GAAD,EAAMC,IAAN,KAAe;AAAE;AACb,UAAMC,WAAW,EAAjB;AACA,UAAMC,MAAM,qEACZ,kDADY,GAEZ,mEAFY,GAGZ,mEAHY,GAIZ,wCAJY,GAKR,kFALJ;AAMAnB,eAAWoB,KAAX,CAAiBD,GAAjB,EAAsB,CAACE,GAAD,EAAMC,MAAN,KAAiB;AACnC,YAAID,GAAJ,EAAS,MAAMA,GAAN;AACTH,iBAASK,OAAT,GAAmBD,MAAnB;AACAL,aAAKO,GAAL,CAAStB,UAAUgB,QAAV,EAAoB,IAApB,EAA0B,CAA1B,CAAT;AACH,KAJD;AAKH,CAdD;AAeAX,IAAIQ,GAAJ,CAAQ,oBAAR,EACA,CAACC,GAAD,EAAMS,GAAN,KAAc;AACV,QAAIC,kBAAkB,IAAtB;AACA,UAAMC,cAAc,0CACpB,kDADoB,GAEpB,kFAFoB,GAGpB,6DAHoB,GAIhB,2CAJgB,GAKhB,uEALgB,GAMhB,oEANJ;;AAQA3B,eAAWoB,KAAX,CAAiBO,WAAjB,EAA8B,CAACX,IAAIY,MAAJ,CAAWC,EAAZ,CAA9B,EACE,CAACR,GAAD,EAAMC,MAAN,KAAiB;AACf,YAAID,GAAJ,EAAS,MAAMA,GAAN;AACTK,0BAAkBJ,MAAlB;AACAG,YAAID,GAAJ,CAAQtB,UAAUwB,eAAV,EAA2B,IAA3B,EAAiC,CAAjC,CAAR;AACH,KALD;AAMH,CAjBD;AAkBAnB,IAAIuB,IAAJ,CAAS,UAAT,EAAqBjB,UAArB,EAAiC,CAACG,GAAD,EAAMC,IAAN,KAAe;AAC9C,UAAMc,SAAS,oCAAmBf,IAAIgB,IAAJ,CAASC,KAA5B,EAAmCjB,IAAIgB,IAAJ,CAASE,gBAA5C,EACdlB,IAAIgB,IAAJ,CAASG,eADK,EACYnB,IAAIgB,IAAJ,CAASI,IADrB,EAC2BpB,IAAIgB,IAAJ,CAASK,IADpC,CAAf;AAECN,WAAOO,IAAP;AACDrB,SAAKsB,IAAL,CAAU,SAAV;AACD,CALD;AAMAhC,IAAIiC,MAAJ,CAAW,IAAX,EAAiB,MAAM;AACrBC,YAAQC,GAAR,CAAY,wCAAZ;AACD,CAFD","file":"server.js","sourcesContent":["//imports\r\nimport { DBcon } from './db_connection';\nimport { ResearchOutput } from './research_output';\r\n//database connection\r\nconst dbCon = new DBcon();\r\nconst connection = dbCon.getConnection();\r\n//other required modules\r\nconst stringify = require('json-stringify-safe');\r\nconst express = require('express'); //for converting circular objects to json\r\nconst cors = require('cors'); //cross-site orign\r\nconst bodyParser = require('body-parser');\n\n\r\nconst app = express();\r\n//middlewares\r\napp.use(express.static('public')); //serve static files\r\napp.use(cors()); //enables all cors requests\r\n\r\nconst corsOptions = {\r\n    origin: 'http://localhost:8080',\r\n    optionsSuccessStatus: 200 // some legacy browsers (IE11, various SmartTVs) choke on 204\r\n};\r\nconst jsonParser = bodyParser.json();\r\n//routes\r\napp.get('/basic-research-outputs', cors(corsOptions),\r\n(req, resp) => { //returns all research outputs.\r\n    const response = {};\r\n    const sql = 'select research_outputs.ro_id as id,title,type,publication_year,' +\r\n    'additional_info,first_name as Author_First_Name ' +\r\n    ', last_name as Author_Last_Name from users INNER JOIN authors ON ' +\r\n    'users.user_id = authors.author_id INNER JOIN research_outputs ON ' +\r\n    ' research_outputs.ro_id=authors.ro_id ' +\r\n        'INNER JOIN research_types ON  research_outputs.ro_type  = research_types.type_id';\r\n    connection.query(sql, (err, result) => {\r\n        if (err) throw err;\r\n        response.outputs = result;\r\n        resp.end(stringify(response, null, 1));\r\n    });\r\n});\r\napp.get('/detailed_view/:id',\r\n(req, res) => {\r\n    let researchDetails = null;\r\n    const queryString = 'select research_outputs.ro_id as id, ' +\r\n    'title, type, publication_year, additional_info, ' +\r\n    'proof_link, research_types.type as type, users.first_name AS Author_First_Name, ' +\r\n    'users.last_name AS Author_Last_Name from research_outputs  ' +\r\n        'JOIN research_types ON ro_type = type_id ' +\r\n        'JOIN authors ON authors.ro_id = research_outputs.ro_id JOIN users ON ' +\r\n        'users.user_id = authors.author_id WHERE research_outputs.ro_id = ?';\r\n\r\n    connection.query(queryString, [req.params.id],\r\n      (err, result) => {\r\n        if (err) throw err;\r\n        researchDetails = result;\r\n        res.end(stringify(researchDetails, null, 1));\r\n    });\r\n});\napp.post('/outputs', jsonParser, (req, resp) => {\n  const output = new ResearchOutput(req.body.title, req.body.publication_year,\n   req.body.additional_info, req.body.text, req.body.type);\n   output.save();\n  resp.send('success');\n});\r\napp.listen(3500, () => {\r\n  console.log('server started: listening at port:3500');\r\n});\r\n"]}