{"version":3,"sources":["../src/server.js"],"names":["db_con","connection","getConnection","stringify","require","express","cors","fs","app","use","static","corsOptions","origin","optionsSuccessStatus","get","req","resp","next","response","sql","query","err","result","fields","outputs","end","res","researchDetails","queryString","params","_id","field","send","listen","console","log"],"mappings":";;AACA;;AACA;AACA,IAAIA,SAAS,0BAAb,C,CAHA;;AAIA,IAAIC,aAAaD,OAAOE,aAAP,EAAjB;AACA;AACA,IAAIC,YAAYC,QAAQ,qBAAR,CAAhB;AACA,IAAIC,UAAUD,QAAQ,SAAR,CAAd,C,CAAkC;AAClC,IAAIE,OAAOF,QAAQ,MAAR,CAAX,C,CAA4B;AAC5B,IAAIG,KAAKH,QAAQ,IAAR,CAAT,C,CAAwB;AACxB,IAAII,MAAMH,SAAV;AACA;AACAG,IAAIC,GAAJ,CAAQJ,QAAQK,MAAR,CAAe,QAAf,CAAR,E,CAAmC;AACnCF,IAAIC,GAAJ,CAAQH,MAAR,E,CAAiB;AACjB,IAAIK,cAAc;AACdC,YAAQ,uBADM;AAEdC,0BAAsB,GAFR,CAEY;;AAE9B;AAJkB,CAAlB,CAKAL,IAAIM,GAAJ,CAAQ,GAAR,EAAYR,KAAKK,WAAL,CAAZ,EAA8B,UAAUI,GAAV,EAAcC,IAAd,EAAmBC,IAAnB,EAAyB;AAAE;AACrD,QAAIC,WAAU,EAAd;AACA,QAAIC,MAAM,oNACN,kFADJ;AAEAlB,eAAWmB,KAAX,CAAiBD,GAAjB,EAAqB,UAAUE,GAAV,EAAcC,MAAd,EAAqBC,MAArB,EAA6B;AAC9C,YAAGF,GAAH,EAAQ,MAAMA,GAAN;AACRH,iBAASM,OAAT,GAAmBF,MAAnB;AACAN,aAAKS,GAAL,CAAStB,UAAUe,QAAV,EAAmB,IAAnB,EAAwB,CAAxB,CAAT;AACH,KAJD;AAKH,CATD;AAUAV,IAAIM,GAAJ,CAAQ,qBAAR,EAA+B,UAAUC,GAAV,EAAeW,GAAf,EAAoB;;AAE/C,QAAIC,eAAJ;;AAEA,QAAIC,cAAc,uMACd,oKADJ;;AAGA3B,eAAWmB,KAAX,CAAiBQ,WAAjB,EAA8B,CAACb,IAAIc,MAAJ,CAAWC,GAAZ,CAA9B,EAAgD,UAAUT,GAAV,EAAeC,MAAf,EAAuBS,KAAvB,EAA8B;AAC1E,YAAIV,GAAJ,EAAS,MAAMA,GAAN;;AAETM,0BAAkBL,MAAlB;AACAI,YAAIM,IAAJ,CAAS7B,UAAUwB,eAAV,EAA0B,IAA1B,EAA+B,CAA/B,CAAT;AACH,KALD;AAOH,CAdD;;AAgBAnB,IAAIyB,MAAJ,CAAW,IAAX,EAAgB,MAAI;AAClBC,YAAQC,GAAR,CAAY,wCAAZ;AACD,CAFD","file":"server.js","sourcesContent":["//imports\r\nimport { DBcon } from \"./db_connection\";\r\n//database connection\r\nlet db_con = new DBcon();\r\nlet connection = db_con.getConnection();\r\n//other required modules\r\nlet stringify = require('json-stringify-safe');\r\nlet express = require('express'); //for converting circular objects to json\r\nlet cors = require(\"cors\"); //cross-site orign\r\nlet fs = require(\"fs\"); //file system\r\nlet app = express();\r\n//middlewares\r\napp.use(express.static(\"public\")); //serve static files\r\napp.use(cors()); //enables all cors requests\r\nvar corsOptions = {\r\n    origin: 'http://localhost:8080',\r\n    optionsSuccessStatus: 200 // some legacy browsers (IE11, various SmartTVs) choke on 204\r\n}\r\n//routes\r\napp.get(\"/\",cors(corsOptions),function (req,resp,next) { //returns all research outputs.\r\n    var response ={};\r\n    var sql = \"select title,type,publication_year,additional_info,first_name as author from users INNER JOIN authors ON users.user_id = authors.author_id INNER JOIN research_outputs ON research_outputs.ro_id=authors.ro_id \" +\r\n        \"INNER JOIN research_types ON  research_outputs.ro_type  = research_types.type_id\";\r\n    connection.query(sql,function (err,result,fields) {\r\n        if(err) throw err;\r\n        response.outputs = result;\r\n        resp.end(stringify(response,null,1));\r\n    })\r\n})\r\napp.get('/detailed_view/:_id', function (req, res) {\r\n\r\n    var researchDetails;\r\n\r\n    var queryString = \"select title, type, publication_year, additional_info, proof_link, research_types.type as type, users.first_name AS Author_First_Name, users.last_name AS Author_Last_Name from research_outputs  \" +\r\n        \"JOIN research_types ON ro_type = type_id  JOIN authors ON authors.ro_id = research_outputs.ro_id JOIN users ON users.user_id = authors.author_id WHERE ro_type = ?\";\r\n\r\n    connection.query(queryString, [req.params._id], function (err, result, field) {\r\n        if (err) throw err;\r\n\r\n        researchDetails = result;\r\n        res.send(stringify(researchDetails,null,1));\r\n    });\r\n\r\n})\r\n\r\napp.listen(3000,()=>{\r\n  console.log(\"server started: listening at port:3000\");\r\n});\r\n"]}