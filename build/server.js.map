{"version":3,"sources":["../src/server.js"],"names":["dbCon","connection","getConnection","stringify","require","express","cors","app","use","static","corsOptions","origin","optionsSuccessStatus","get","req","resp","response","sql","query","err","result","outputs","end","res","researchDetails","queryString","params","id","send","listen","console","log"],"mappings":";;AACA;;AACA;AACA,MAAMA,QAAQ,0BAAd,C,CAHA;;AAIA,MAAMC,aAAaD,MAAME,aAAN,EAAnB;AACA;AACA,MAAMC,YAAYC,QAAQ,qBAAR,CAAlB;AACA,MAAMC,UAAUD,QAAQ,SAAR,CAAhB,C,CAAoC;AACpC,MAAME,OAAOF,QAAQ,MAAR,CAAb,C,CAA8B;;AAE9B,MAAMG,MAAMF,SAAZ;AACA;AACAE,IAAIC,GAAJ,CAAQH,QAAQI,MAAR,CAAe,QAAf,CAAR,E,CAAmC;AACnCF,IAAIC,GAAJ,CAAQF,MAAR,E,CAAiB;AACjB,MAAMI,cAAc;AAChBC,YAAQ,uBADQ;AAEhBC,0BAAsB,GAFN,CAEU;AAFV,CAApB;AAIA;AACAL,IAAIM,GAAJ,CAAQ,yBAAR,EAAmCP,KAAKI,WAAL,CAAnC,EACA,CAACI,GAAD,EAAMC,IAAN,KAAe;AAAE;AACb,UAAMC,WAAW,EAAjB;AACA,UAAMC,MAAM,qEACZ,kDADY,GAEZ,mEAFY,GAGZ,mEAHY,GAIZ,wCAJY,GAKR,kFALJ;AAMAhB,eAAWiB,KAAX,CAAiBD,GAAjB,EAAsB,CAACE,GAAD,EAAMC,MAAN,KAAiB;AACnC,YAAID,GAAJ,EAAS,MAAMA,GAAN;AACTH,iBAASK,OAAT,GAAmBD,MAAnB;AACAL,aAAKO,GAAL,CAASnB,UAAUa,QAAV,EAAoB,IAApB,EAA0B,CAA1B,CAAT;AACH,KAJD;AAKH,CAdD;AAeAT,IAAIM,GAAJ,CAAQ,oBAAR,EACA,CAACC,GAAD,EAAMS,GAAN,KAAc;AACV,QAAIC,kBAAkB,IAAtB;AACA,UAAMC,cAAc,0CACpB,kDADoB,GAEpB,kFAFoB,GAGpB,6DAHoB,GAIhB,2CAJgB,GAKhB,uEALgB,GAMhB,oEANJ;;AAQAxB,eAAWiB,KAAX,CAAiBO,WAAjB,EAA8B,CAACX,IAAIY,MAAJ,CAAWC,EAAZ,CAA9B,EACE,CAACR,GAAD,EAAMC,MAAN,KAAiB;AACf,YAAID,GAAJ,EAAS,MAAMA,GAAN;AACTK,0BAAkBJ,MAAlB;AACAG,YAAIK,IAAJ,CAASzB,UAAUqB,eAAV,EAA2B,IAA3B,EAAiC,CAAjC,CAAT;AACH,KALD;AAMH,CAjBD;AAkBAjB,IAAIsB,MAAJ,CAAW,IAAX,EAAiB,MAAM;AACrBC,YAAQC,GAAR,CAAY,wCAAZ;AACD,CAFD","file":"server.js","sourcesContent":["//imports\r\nimport { DBcon } from './db_connection';\r\n//database connection\r\nconst dbCon = new DBcon();\r\nconst connection = dbCon.getConnection();\r\n//other required modules\r\nconst stringify = require('json-stringify-safe');\r\nconst express = require('express'); //for converting circular objects to json\r\nconst cors = require('cors'); //cross-site orign\r\n\r\nconst app = express();\r\n//middlewares\r\napp.use(express.static('public')); //serve static files\r\napp.use(cors()); //enables all cors requests\r\nconst corsOptions = {\r\n    origin: 'http://localhost:8080',\r\n    optionsSuccessStatus: 200 // some legacy browsers (IE11, various SmartTVs) choke on 204\r\n};\r\n//routes\r\napp.get('/basic-research-outputs', cors(corsOptions),\r\n(req, resp) => { //returns all research outputs.\r\n    const response = {};\r\n    const sql = 'select research_outputs.ro_id as id,title,type,publication_year,' +\r\n    'additional_info,first_name as Author_First_name ' +\n    ', last_name as Author_Last_Name from users INNER JOIN authors ON ' +\r\n    'users.user_id = authors.author_id INNER JOIN research_outputs ON ' +\r\n    ' research_outputs.ro_id=authors.ro_id ' +\r\n        'INNER JOIN research_types ON  research_outputs.ro_type  = research_types.type_id';\r\n    connection.query(sql, (err, result) => {\r\n        if (err) throw err;\r\n        response.outputs = result;\r\n        resp.end(stringify(response, null, 1));\r\n    });\r\n});\r\napp.get('/detailed_view/:id',\r\n(req, res) => {\r\n    let researchDetails = null;\r\n    const queryString = 'select research_outputs.ro_id as id, ' +\n    'title, type, publication_year, additional_info, ' +\r\n    'proof_link, research_types.type as type, users.first_name AS Author_First_Name, ' +\r\n    'users.last_name AS Author_Last_Name from research_outputs  ' +\r\n        'JOIN research_types ON ro_type = type_id ' +\r\n        'JOIN authors ON authors.ro_id = research_outputs.ro_id JOIN users ON ' +\r\n        'users.user_id = authors.author_id WHERE research_outputs.ro_id = ?';\r\n\r\n    connection.query(queryString, [req.params.id],\r\n      (err, result) => {\r\n        if (err) throw err;\r\n        researchDetails = result;\r\n        res.send(stringify(researchDetails, null, 1));\r\n    });\r\n});\r\napp.listen(3000, () => {\r\n  console.log('server started: listening at port:3000');\r\n});\r\n"]}